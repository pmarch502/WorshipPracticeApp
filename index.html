<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Worship Practice App - Multitrack Audio Player</title>
    <link rel="stylesheet" href="css/styles.css">

	<!-- favicon.ico - begin -->
	<link rel="icon" href="RLC_favicon.png" type="image/png" />
	<!-- favicon.ico - end -->
</head>
<body>
    <div id="app">
        <!-- Tab Bar -->
        <header id="tab-bar">
            <button id="add-song-btn" class="add-btn circular" title="Open Song">
                <svg viewBox="0 0 24 24" width="16" height="16" style="pointer-events: none;">
                    <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
            </button>
            <div id="tabs-container">
                <!-- Tabs will be dynamically inserted here -->
            </div>
            <!-- Arrangement/Mute Selector Dropdown (shown when song is open) -->
            <div id="arrangement-selector" class="hidden">
                <button id="arrangement-dropdown-btn" class="dropdown-btn">
                    <span class="dropdown-btn-text">Arrangements</span>
                    <svg class="dropdown-arrow" viewBox="0 0 24 24" width="12" height="12">
                        <path fill="currentColor" d="M7 10l5 5 5-5z"/>
                    </svg>
                </button>
                <div id="arrangement-dropdown-menu" class="dropdown-menu hidden">
                    <!-- Menu items populated dynamically by tabs.js -->
                </div>
            </div>
            <!-- Song picker dropdown (hidden by default) -->
            <div id="song-picker" class="picker-dropdown hidden">
                <div class="picker-header">SELECT A SONG</div>
                <div id="song-picker-list" class="picker-list">
                    <!-- Song options will be inserted here -->
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="main-content">
            <!-- Empty state when no songs are open -->
            <div id="no-song-empty-state" class="empty-state full-screen">
                <svg viewBox="0 0 24 24" width="64" height="64">
                    <path fill="currentColor" d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                </svg>
                <p>No song open</p>
                <p class="hint">Click the + button above to open a song</p>
            </div>
            <!-- Left Panel - Track Controls -->
            <aside id="track-controls-panel">
                <div id="track-controls-header">
                    <div id="track-header-top-row">
                        <span id="cache-indicator" title="Cache usage">
                            <svg viewBox="0 0 24 24" width="15" height="15">
                                <path fill="currentColor" d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/>
                            </svg>
                            <span id="cache-usage">0%</span>
                        </span>
                        <button id="help-btn" class="icon-btn" title="User Guide">
                            <svg viewBox="0 0 24 24" width="24" height="24">
                                <path fill="currentColor" d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/>
                            </svg>
                        </button>
                    </div>
                    <!-- Zoom Controls (center row) -->
                    <div id="track-header-zoom-row">
                        <button id="zoom-fit" class="icon-btn zoom-fit-btn" title="Fit to Window">
                            <svg viewBox="0 0 40 24" width="40" height="24">
                                <path fill="currentColor" d="M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm32 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"/>
                                <text x="20" y="16" fill="currentColor" font-size="12" font-weight="600" text-anchor="middle" font-family="system-ui, sans-serif">Fit</text>
                            </svg>
                        </button>
                        <div id="zoom-knob-container"></div>
                        <span id="zoom-value" class="zoom-value">100%</span>
                    </div>
                    <div id="track-header-bottom-row">
                        <span>TRACKS</span>
                        <button id="add-track-btn" class="add-btn circular" title="Add Tracks">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="track-controls-list">
                    <!-- Track controls will be dynamically inserted here -->
                </div>
                <div id="track-controls-empty" class="empty-state">
                    <p>No tracks loaded</p>
                    <p class="hint">Click + to add tracks</p>
                </div>
            </aside>

            <!-- Right Panel - Timeline & Waveforms -->
            <section id="waveform-panel">
                <!-- Timeline Header -->
                <div id="timeline-header">
                    <!-- Dual timeline display: Beats on top, Time on bottom -->
                    <div id="timeline-display">
                        <canvas id="timeline-beats-canvas" class="timeline-canvas"></canvas>
                        <div id="timeline-divider"></div>
                        <canvas id="timeline-time-canvas" class="timeline-canvas"></canvas>
                    </div>
                    <!-- Arrangement sections bar (Phase 3) -->
                    <div id="arrangement-sections-bar"></div>
                </div>

                <!-- Waveform Container -->
                <div id="waveform-container">
                    <div id="waveform-scroll-area">
                        <div id="waveform-tracks">
                            <!-- Waveform tracks will be dynamically inserted here -->
                            <!-- Playhead -->
                            <div id="playhead">
                                <div id="playhead-line"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Transport Bar -->
        <footer id="transport-bar">
            <span id="app-version">v2.0.0</span>
            <div id="transport-controls">
                <!-- Time Display -->
                <div id="time-display">
                    <span id="current-time">00:00:00.000</span>
                    <span class="time-separator">/</span>
                    <span id="total-time">00:00:00.000</span>
                </div>

                <!-- Playback Controls -->
                <div id="playback-controls">
                    <button id="btn-beginning" class="transport-btn" title="Return to Beginning">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
                        </svg>
                    </button>
                    <button id="btn-stop" class="transport-btn" title="Stop (Space)">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <rect fill="currentColor" x="6" y="6" width="12" height="12"/>
                        </svg>
                    </button>
                    <button id="btn-play" class="transport-btn primary" title="Play (Space)">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M8 5v14l11-7z"/>
                        </svg>
                    </button>
                    <button id="btn-pause" class="transport-btn" title="Pause (Ctrl+Space)">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                        </svg>
                    </button>
                    <button id="btn-loop" class="transport-btn" title="Loop">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
                        </svg>
                    </button>
                </div>

                <!-- Speed Control -->
                <div class="transport-knob-group">
                    <label>SPEED</label>
                    <span class="knob-value editable" id="speed-value" data-param="speed" title="Click to edit">1.00x</span>
                </div>

                <!-- Pitch Control -->
                <div class="transport-select-group">
                    <label id="pitch-label" for="pitch-select">PITCH</label>
                    <select id="pitch-select">
                        <option value="6">+6</option>
                        <option value="5">+5</option>
                        <option value="4">+4</option>
                        <option value="3">+3</option>
                        <option value="2">+2</option>
                        <option value="1">+1</option>
                        <option value="0" selected>0</option>
                        <option value="-1">-1</option>
                        <option value="-2">-2</option>
                        <option value="-3">-3</option>
                        <option value="-4">-4</option>
                        <option value="-5">-5</option>
                        <option value="-6">-6</option>
                    </select>
                </div>

                <!-- Tempo Control -->
                <div class="transport-display-group">
                    <label>TEMPO</label>
                    <span class="knob-value read-only" id="tempo-value">120 BPM</span>
                </div>

                <!-- Time Signature -->
                <div class="transport-display-group">
                    <label>TIME SIG</label>
                    <span id="time-signature" class="knob-value">4/4</span>
                </div>

            </div>
        </footer>

        <!-- Modal Container -->
        <div id="modal-overlay" class="hidden">
            <div id="modal-dialog">
                <div id="modal-header">
                    <h3 id="modal-title">Confirm</h3>
                    <button id="modal-close" class="icon-btn">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                </div>
                <div id="modal-content">
                    <!-- Modal content will be inserted here -->
                </div>
                <div id="modal-actions">
                    <button id="modal-cancel" class="btn btn-secondary">Cancel</button>
                    <button id="modal-confirm" class="btn btn-primary">Confirm</button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="hidden">
            <div class="loading-spinner"></div>
            <p id="loading-message">Loading...</p>
        </div>

        <!-- Beat Time Tooltip (for Ctrl+hover on timeline) -->
        <div id="beat-time-tooltip" class="beat-time-tooltip hidden"></div>

    </div>

    <!-- Scripts -->
    <script src="js/lib/soundtouch.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>
